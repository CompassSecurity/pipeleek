version: 2
project_name: pipeleek
builds:
  - id: "pipeleek"
    main: ./cmd/pipeleek
    binary: pipeleek
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -buildid=
      - -X github.com/CompassSecurity/pipeleek/internal/cmd.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd.Date={{.Date}}
  # Platform-specific builds - only built on release (tagged builds)
  - id: "pipeleek-gitlab"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleek-gitlab
    binary: pipeleek-gitlab
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -buildid=
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Date={{.Date}}
  - id: "pipeleek-github"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleek-github
    binary: pipeleek-github
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -buildid=
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Date={{.Date}}
  - id: "pipeleek-bitbucket"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleek-bitbucket
    binary: pipeleek-bitbucket
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -buildid=
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Date={{.Date}}
  - id: "pipeleek-devops"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleek-devops
    binary: pipeleek-devops
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -buildid=
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Date={{.Date}}
  - id: "pipeleek-gitea"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleek-gitea
    binary: pipeleek-gitea
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -buildid=
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleek/internal/cmd/common.Date={{.Date}}

archives:
  - formats: binary
    name_template: "{{ .Binary }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"

release:
  github:
    owner: CompassSecurity
    name: pipeleek
