package jobtoken

import (
	"encoding/hex"
	"strings"
	"testing"
)

func TestGenerateBranchName(t *testing.T) {
	branch, err := generateBranchName()
	if err != nil {
		t.Fatalf("unexpected error: %v", err)
	}

	if !strings.HasPrefix(branch, branchPrefix) {
		t.Fatalf("expected prefix %q, got %q", branchPrefix, branch)
	}

	raw := strings.TrimPrefix(branch, branchPrefix)
	if len(raw) != 8 {
		t.Fatalf("expected 8 hex characters, got %d", len(raw))
	}

	if _, err := hex.DecodeString(raw); err != nil {
		t.Fatalf("expected hex suffix, got %q", raw)
	}
}
